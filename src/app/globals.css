/* Use dynamic viewport units for better mobile handling */
.h-dvh {
  height: 100dvh;
}

/* Safe area padding for mobile browsers */
.pb-safe {
  padding-bottom: max(0.75rem, env(safe-area-inset-bottom, 0.75rem));
}

@media (min-width: 768px) {
  .pb-safe {
    padding-bottom: 0;
  }
}

/* Hide scrollbar for Chrome, Safari and Opera */
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* Hide scrollbar for IE, Edge and Firefox */
.scrollbar-hide {
  -ms-overflow-style: none; /* IE and Edge */
  scrollbar-width: none; /* Firefox */
}

/* Safari Mobile Scrolling Fix */
@supports (-webkit-touch-callout: none) {
  .safari-scroll-fix {
    overflow-y: scroll;
    -webkit-overflow-scrolling: touch;
    height: 100%;
  }
}

/* This ensures the sidebar height properly accounts for dynamic viewport height */
.h-screen {
  height: 100dvh; /* Dynamic viewport height - adjusts as the address bar appears/disappears */
}

@keyframes sheen {
  0% {
    background-position: -120% 0;
  }
  100% {
    background-position: 220% 0;
  }
}

/* Prevent vertical scrollbars in message content */
.katex-display {
  overflow-x: auto !important;
  overflow-y: hidden !important;
  max-width: 100%;
}

.katex-display > .katex {
  max-width: 100%;
  overflow-x: auto !important;
  overflow-y: visible !important;
  padding: 0.5rem 0;
}

/* Ensure code blocks don't create vertical scrollbars */
.prose pre {
  overflow-y: visible !important;
  max-height: none !important;
}

/* Prevent vertical scrollbars while maintaining horizontal scroll for wide content */
.prose {
  overflow-y: visible !important;
}

/* Prose responsive fixes */
.prose {
  max-width: 100% !important;
  overflow-wrap: break-word;
  word-wrap: break-word;
  min-width: 0; /* Allow prose to shrink */
}

/* Fix code blocks to be contained but scrollable */
.prose pre {
  max-width: 100%;
  overflow-x: auto !important; /* Force horizontal scroll for code blocks */
  overflow-y: visible;
  white-space: pre;
}

/* Inline code styling - override typography plugin defaults */
/* Only target inline code, not code blocks (which are inside <pre>) */
.prose :not(pre) > code {
  word-break: break-word;
  color: hsl(var(--content-primary)) !important;
  vertical-align: baseline !important;
  background-color: hsl(var(--muted)) !important;
  padding: 0.25rem 0.375rem !important;
  border-radius: 0.375rem !important;
  font-size: 0.875rem !important;
  font-family:
    'Aeonik Fono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
    monospace !important;
}

/* Remove decorative backticks added by typography plugin */
.prose :not(pre) > code::before,
.prose :not(pre) > code::after {
  content: '' !important;
  display: none !important;
}

.dark .prose :not(pre) > code {
  color: hsl(var(--content-primary)) !important;
  vertical-align: baseline !important;
  background-color: hsl(var(--muted)) !important;
  padding: 0.25rem 0.375rem !important;
  border-radius: 0.375rem !important;
  font-size: 0.875rem !important;
  font-family:
    'Aeonik Fono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
    monospace !important;
}

.dark .prose :not(pre) > code::before,
.dark .prose :not(pre) > code::after {
  content: '' !important;
  display: none !important;
}

/* Tables should scroll horizontally when needed */
.table-container {
  max-width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Prevent horizontal scroll at message level */
.prose > * {
  max-width: 100%;
}

/* Fix images */
.prose img {
  max-width: 100%;
  height: auto;
}

/* Comprehensive prose color overrides for consistent text colors */
.prose {
  color: hsl(var(--content-primary)) !important;
}

.prose blockquote {
  word-wrap: break-word;
  color: hsl(var(--content-primary)) !important;
  border-left: none !important;
  padding-left: 1.5rem !important;
  font-style: normal !important;
  quotes: none !important;
}

.prose blockquote::before,
.prose blockquote::after,
.prose blockquote p::before,
.prose blockquote p::after {
  content: '' !important;
  display: none !important;
}

.prose blockquote p {
  color: hsl(var(--content-primary)) !important;
}

.prose h1,
.prose h2,
.prose h3,
.prose h4,
.prose h5,
.prose h6 {
  color: hsl(var(--content-primary)) !important;
}

.prose p {
  color: hsl(var(--content-primary)) !important;
}

.prose ul,
.prose ol {
  color: hsl(var(--content-primary)) !important;
}

.prose li {
  color: hsl(var(--content-primary)) !important;
}

.prose li::marker {
  color: hsl(var(--content-primary)) !important;
}

.prose strong {
  color: hsl(var(--content-primary)) !important;
  vertical-align: baseline !important;
}

.prose em {
  color: hsl(var(--content-primary)) !important;
  vertical-align: baseline !important;
}

.prose a {
  vertical-align: baseline !important;
}

.prose table {
  color: hsl(var(--content-primary)) !important;
}

.prose thead {
  color: hsl(var(--content-primary)) !important;
}

.prose tbody {
  color: hsl(var(--content-primary)) !important;
}

.prose th {
  color: hsl(var(--content-primary)) !important;
}

.prose td {
  color: hsl(var(--content-primary)) !important;
}

.prose hr {
  border-color: hsl(var(--border-subtle)) !important;
}

/* Dark mode specific overrides to prevent any prose-invert remnants */
.dark .prose {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose blockquote {
  color: hsl(var(--content-primary)) !important;
  border-left: none !important;
  padding-left: 1.5rem !important;
  font-style: normal !important;
  quotes: none !important;
}

.dark .prose blockquote::before,
.dark .prose blockquote::after,
.dark .prose blockquote p::before,
.dark .prose blockquote p::after {
  content: '' !important;
  display: none !important;
}

.dark .prose blockquote p {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose h1,
.dark .prose h2,
.dark .prose h3,
.dark .prose h4,
.dark .prose h5,
.dark .prose h6 {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose p {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose ul,
.dark .prose ol {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose li {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose li::marker {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose strong {
  color: hsl(var(--content-primary)) !important;
  vertical-align: baseline !important;
}

.dark .prose em {
  color: hsl(var(--content-primary)) !important;
  vertical-align: baseline !important;
}

.dark .prose a {
  vertical-align: baseline !important;
}

.dark .prose table {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose thead {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose tbody {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose th {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose td {
  color: hsl(var(--content-primary)) !important;
}

.dark .prose hr {
  border-color: hsl(var(--border-subtle)) !important;
}

/* Responsive adjustments for narrow screens */
@media (max-width: 640px) {
  /* Reduce code font size on very small screens */
  .prose pre {
    font-size: 0.75rem;
  }

  /* Make tables more compact */
  .prose table {
    font-size: 0.75rem;
  }

  /* Ensure long URLs break */
  .prose a {
    word-break: break-all;
  }
}

/* KaTeX specific overflow fixes */
.katex-html {
  overflow-x: auto !important;
  overflow-y: visible !important;
}

.katex .base {
  overflow-y: visible !important;
}

/* Subtle one-shot sheen for text clipped backgrounds */
/* Removed sheen styles */

/* Prevent browser scroll anchoring on dynamic streaming blocks */
.no-scroll-anchoring {
  overflow-anchor: none;
}
